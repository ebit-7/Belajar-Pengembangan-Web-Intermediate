(()=>{"use strict";var n={56:(n,e,t)=>{n.exports=function(n){var e=t.nc;e&&n.setAttribute("nonce",e)}},72:n=>{var e=[];function t(n){for(var t=-1,o=0;o<e.length;o++)if(e[o].identifier===n){t=o;break}return t}function o(n,o){for(var a={},i=[],s=0;s<n.length;s++){var l=n[s],d=o.base?l[0]+o.base:l[0],c=a[d]||0,u="".concat(d," ").concat(c);a[d]=c+1;var p=t(u),m={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)e[p].references++,e[p].updater(m);else{var g=r(m,o);o.byIndex=s,e.splice(s,0,{identifier:u,updater:g,references:1})}i.push(u)}return i}function r(n,e){var t=e.domAPI(e);return t.update(n),function(e){if(e){if(e.css===n.css&&e.media===n.media&&e.sourceMap===n.sourceMap&&e.supports===n.supports&&e.layer===n.layer)return;t.update(n=e)}else t.remove()}}n.exports=function(n,r){var a=o(n=n||[],r=r||{});return function(n){n=n||[];for(var i=0;i<a.length;i++){var s=t(a[i]);e[s].references--}for(var l=o(n,r),d=0;d<a.length;d++){var c=t(a[d]);0===e[c].references&&(e[c].updater(),e.splice(c,1))}a=l}}},113:n=>{n.exports=function(n,e){if(e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}},314:n=>{n.exports=function(n){var e=[];return e.toString=function(){return this.map((function(e){var t="",o=void 0!==e[5];return e[4]&&(t+="@supports (".concat(e[4],") {")),e[2]&&(t+="@media ".concat(e[2]," {")),o&&(t+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),t+=n(e),o&&(t+="}"),e[2]&&(t+="}"),e[4]&&(t+="}"),t})).join("")},e.i=function(n,t,o,r,a){"string"==typeof n&&(n=[[null,n,void 0]]);var i={};if(o)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(i[l]=!0)}for(var d=0;d<n.length;d++){var c=[].concat(n[d]);o&&i[c[0]]||(void 0!==a&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=a),t&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=t):c[2]=t),r&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=r):c[4]="".concat(r)),e.push(c))}},e}},379:(n,e,t)=>{t.d(e,{A:()=>s});var o=t(601),r=t.n(o),a=t(314),i=t.n(a)()(r());i.push([n.id,'/* =====================\n   Base Styles\n====================== */\nhtml, body {\n  height: 100%;\n  margin: 0;\n  padding: 0;\n  font-family: \'Segoe UI\', Tahoma, Geneva, Verdana, sans-serif;\n  background-color: #f5f6fa;\n  color: #333;\n}\n\n.page-wrapper {\n  display: flex;\n  flex-direction: column;\n  min-height: 100vh;\n}\n\nmain {\n  flex: 1;\n  padding: 2rem;\n  box-sizing: border-box;\n}\n\n/* =====================\n   Skip Link\n====================== */\n.skip-link {\n  position: absolute;\n  left: -999px;\n  top: auto;\n  width: 1px;\n  height: 1px;\n  overflow: hidden;\n}\n\n.skip-link:focus {\n  position: static;\n  width: auto;\n  height: auto;\n  margin: 1rem;\n  padding: 0.5rem 1rem;\n  background: #2980b9;\n  color: white;\n  z-index: 100;\n  border-radius: 4px;\n}\n\n/* =====================\n   Navigation Styles (Unified & Updated)\n====================== */\n/* =====================\n   Navigation Styles (Modern & Smooth)\n====================== */\nnav {\n  background-color: #2c3e50; /* warna lebih dalam dan elegan */\n  font-family: \'Segoe UI\', Tahoma, Geneva, Verdana, sans-serif;\n  padding: 0 1.5rem;\n  box-sizing: border-box;\n  box-shadow: 0 4px 10px rgba(44, 62, 80, 0.8);\n  position: relative;\n  z-index: 200;\n  user-select: none;\n}\n\nnav .nav-container {\n  max-width: 1200px;\n  margin: 0 auto;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  height: 64px;\n  padding: 0 1rem;\n}\n\nnav .brand {\n  color: #ecf0f1;\n  font-weight: 700;\n  font-size: 1.8rem;\n  cursor: pointer;\n  outline-offset: 4px;\n  outline-color: transparent;\n  transition: outline-color 0.3s ease, color 0.3s ease;\n  letter-spacing: 0.08em;\n  user-select: none;\n  position: relative;\n  z-index: 201;\n}\n\nnav .brand:focus,\nnav .brand:hover {\n  color: #1abc9c;\n  outline: 3px solid #1abc9c;\n  outline-offset: 5px;\n  border-radius: 6px;\n}\n\n.nav-list {\n  list-style: none;\n  display: flex;\n  gap: 1.75rem; /* jarak antar menu lebih lega */\n  margin: 0;\n  padding: 0;\n  align-items: center;\n}\n\n.nav-list li a {\n  color: #ecf0f1;\n  text-decoration: none;\n  padding: 10px 22px;\n  border-radius: 10px;\n  font-weight: 600;\n  font-size: 1.05rem;\n  transition: background-color 0.35s cubic-bezier(0.4, 0, 0.2, 1), \n              color 0.35s cubic-bezier(0.4, 0, 0.2, 1),\n              box-shadow 0.35s cubic-bezier(0.4, 0, 0.2, 1);\n  display: block;\n  box-shadow: inset 0 0 0 0 transparent;\n}\n\n.nav-list li a:hover,\n.nav-list li a:focus {\n  background-color: #1abc9c;\n  color: #2c3e50;\n  box-shadow: inset 0 0 12px #16a085;\n  outline: none;\n  transform: scale(1.05);\n}\n\n.nav-list li:last-child {\n  margin-left: auto; /* logout tetap di ujung kanan */\n}\n\n/* =====================\n   Hamburger Button Styles (Modern)\n====================== */\n.hamburger {\n  display: none;\n  flex-direction: column;\n  justify-content: space-around;\n  width: 32px;\n  height: 26px;\n  background: none;\n  border: none;\n  padding: 0;\n  cursor: pointer;\n  position: relative;\n  z-index: 300;\n  transition: transform 0.35s ease;\n}\n\n.hamburger:focus {\n  outline: 3px solid #1abc9c;\n  outline-offset: 4px;\n  border-radius: 6px;\n}\n\n.hamburger .bar {\n  width: 100%;\n  height: 4px;\n  background-color: #ecf0f1;\n  border-radius: 3px;\n  transition: all 0.35s ease;\n  transform-origin: center;\n}\n\n/* Hamburger animation active state */\n.hamburger.active .bar:nth-child(1) {\n  transform: rotate(45deg) translate(6px, 6px);\n}\n\n.hamburger.active .bar:nth-child(2) {\n  opacity: 0;\n}\n\n.hamburger.active .bar:nth-child(3) {\n  transform: rotate(-45deg) translate(6px, -6px);\n}\n\n/* =====================\n   Responsive Navigation (Smooth Slide)\n====================== */\n@media (max-width: 768px) {\n  .hamburger {\n    display: flex;\n    position: absolute;\n    left: 1rem;\n    top: 50%;\n    transform: translateY(-50%);\n  }\n\n  nav .brand {\n    order: 2;\n    flex-grow: 1;\n    text-align: center;\n    font-size: 1.6rem;\n  }\n\n  .nav-list {\n    flex-direction: column;\n    position: absolute;\n    top: 64px;\n    left: 0;\n    right: 0;\n    background-color: #2c3e50;\n    max-height: 0;\n    overflow: hidden;\n    padding: 0;\n    border-radius: 0 0 14px 14px;\n    box-shadow: 0 8px 20px rgba(44, 62, 80, 0.85);\n    transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), padding 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n    z-index: 150;\n  }\n\n  .nav-list.show {\n    max-height: 360px;\n    padding: 1rem 0;\n  }\n\n  .nav-list li {\n    width: 100%;\n    margin-left: 0;\n  }\n\n  .nav-list li a {\n    padding: 16px 2rem;\n    font-size: 1.2rem;\n    width: 100%;\n    transition: background-color 0.3s ease, transform 0.3s ease;\n  }\n\n  .nav-list li a:hover,\n  .nav-list li a:focus {\n    transform: scale(1.08);\n  }\n}\n\n\n\n\n\n/* =====================\n   Login Container\n====================== */\n.login-container {\n  width: 100%;\n  max-width: 400px;\n  margin: 4rem auto;\n  padding: 2rem;\n  background-color: white;\n  border-radius: 12px;\n  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);\n  text-align: center;\n  box-sizing: border-box;\n}\n\n.login-container h2 {\n  margin-bottom: 1.5rem;\n  color: #2c3e50;\n}\n\n.styled-form input,\n.styled-form button {\n  width: 100%;\n  font-size: 1rem;\n  padding: 0.75rem;\n  margin-bottom: 1rem;\n  border-radius: 8px;\n  border: 1px solid #ccc;\n  box-sizing: border-box;\n}\n\n.styled-form button {\n  background-color: #1abc9c;\n  color: white;\n  border: none;\n  cursor: pointer;\n  transition: background-color 0.3s;\n}\n\n.styled-form button:hover {\n  background-color: #16a085;\n}\n\n.login-link {\n  margin-top: 1rem;\n  font-size: 0.95rem;\n}\n\n/* =====================\n   Story Grid & Cards\n====================== */\n.story-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));\n  gap: 1.5rem;\n  margin-top: 1rem;\n}\n\n.story-card {\n  background: #fff;\n  border-radius: 12px;\n  box-shadow: 0 8px 15px rgba(0,0,0,0.1);\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  transition: transform 0.3s ease, box-shadow 0.3s ease;\n}\n\n.story-card:hover {\n  transform: translateY(-5px);\n  box-shadow: 0 15px 25px rgba(0,0,0,0.15);\n}\n\n.story-card img {\n  width: 100%;\n  height: 180px;\n  object-fit: cover;\n  border-bottom: 1px solid #eee;\n}\n\n.story-info {\n  padding: 1rem;\n  flex-grow: 1;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n}\n\n.story-info h3 {\n  margin: 0 0 0.5rem;\n  font-size: 1.2rem;\n  color: #2c3e50;\n}\n\n.story-info p {\n  font-size: 1rem;\n  color: #555;\n  margin: 0 0 0.75rem;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: -webkit-box;\n  -webkit-line-clamp: 3;\n  -webkit-box-orient: vertical;\n}\n\n.story-info small {\n  font-size: 0.85rem;\n  color: #888;\n  text-align: right;\n}\n\n/* =====================\n   Footer\n====================== */\nfooter {\n  background-color: #34495e;\n  color: #ecf0f1;\n  text-align: center;\n  padding: 1rem;\n  font-size: 0.95rem;\n  border-top: 1px solid #2c3e50;\n  flex-shrink: 0;\n}\n\nfooter strong {\n  color: #1abc9c;\n}\n\n/* =====================\n   Add Story Container & Form\n====================== */\n.add-story-container {\n  max-width: 480px;\n  margin: 2rem auto 3rem;\n  background-color: white;\n  padding: 1.5rem 2rem;\n  border-radius: 12px;\n  box-shadow: 0 10px 20px rgba(0,0,0,0.1);\n  box-sizing: border-box;\n}\n\n.add-story-container h2 {\n  text-align: center;\n  margin-bottom: 1.5rem;\n  color: #2c3e50;\n}\n\n.styled-form {\n  display: flex;\n  flex-direction: column;\n}\n\n.styled-form label {\n  margin: 0.75rem 0 0.25rem;\n  font-weight: 600;\n  color: #34495e;\n}\n\n.styled-form input[type="text"],\n.styled-form input[type="number"] {\n  padding: 0.6rem 1rem;\n  font-size: 1rem;\n  border-radius: 8px;\n  border: 1px solid #ccc;\n  outline-offset: 2px;\n  transition: outline-color 0.3s ease;\n}\n\n.styled-form input[type="text"]:focus,\n.styled-form input[type="number"]:focus {\n  outline-color: #1abc9c;\n  border-color: #1abc9c;\n}\n\n.camera-container {\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 0.75rem;\n  margin-bottom: 1rem;\n}\n\n.camera-container video {\n  width: 100%;\n  max-width: 320px;\n  border-radius: 12px;\n  background-color: #000;\n  box-shadow: 0 4px 8px rgba(0,0,0,0.15);\n}\n\n.btn-primary {\n  padding: 0.6rem 1.25rem;\n  background-color: #1abc9c;\n  border: none;\n  color: white;\n  border-radius: 8px;\n  cursor: pointer;\n  font-weight: 700;\n  font-size: 1rem;\n  transition: background-color 0.3s ease;\n}\n\n.btn-primary:hover,\n.btn-primary:focus {\n  background-color: #16a085;\n  outline: none;\n}\n\n.btn-submit {\n  margin-top: 1rem;\n  padding: 0.75rem 0;\n  background-color: #2980b9;\n  border: none;\n  color: white;\n  font-weight: 700;\n  font-size: 1.1rem;\n  border-radius: 12px;\n  cursor: pointer;\n  transition: background-color 0.3s ease;\n}\n\n.btn-submit:hover,\n.btn-submit:focus {\n  background-color: #1f6391;\n  outline: none;\n}\n\n.map-container {\n  width: 100%;\n  height: 320px;\n  margin-top: 1rem;\n  border-radius: 12px;\n  overflow: hidden;\n  box-shadow: 0 5px 15px rgba(0,0,0,0.1);\n  border: 1px solid #ccc;\n}\n\n/* Responsive for add-story */\n@media (max-width: 480px) {\n  .add-story-container {\n    margin: 1rem;\n    padding: 1rem;\n  }\n\n  .camera-container video {\n    max-width: 100%;\n  }\n}\n',""]);const s=i},540:n=>{n.exports=function(n){var e=document.createElement("style");return n.setAttributes(e,n.attributes),n.insert(e,n.options),e}},601:n=>{n.exports=function(n){return n[1]}},659:n=>{var e={};n.exports=function(n,t){var o=function(n){if(void 0===e[n]){var t=document.querySelector(n);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(n){t=null}e[n]=t}return e[n]}(n);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}},825:n=>{n.exports=function(n){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=n.insertStyleElement(n);return{update:function(t){!function(n,e,t){var o="";t.supports&&(o+="@supports (".concat(t.supports,") {")),t.media&&(o+="@media ".concat(t.media," {"));var r=void 0!==t.layer;r&&(o+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),o+=t.css,r&&(o+="}"),t.media&&(o+="}"),t.supports&&(o+="}");var a=t.sourceMap;a&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),e.styleTagTransform(o,n,e.options)}(e,n,t)},remove:function(){!function(n){if(null===n.parentNode)return!1;n.parentNode.removeChild(n)}(e)}}}}},e={};function t(o){var r=e[o];if(void 0!==r)return r.exports;var a=e[o]={id:o,exports:{}};return n[o](a,a.exports,t),a.exports}t.n=n=>{var e=n&&n.__esModule?()=>n.default:()=>n;return t.d(e,{a:e}),e},t.d=(n,e)=>{for(var o in e)t.o(e,o)&&!t.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:e[o]})},t.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),t.r=n=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t.nc=void 0;var o={};t.r(o),t.d(o,{getAllStories:()=>rn,postStory:()=>an});var r={};t.r(r),t.d(r,{renderHome:()=>pn});var a={};t.r(a),t.d(a,{renderAddForm:()=>mn,showError:()=>hn,showLoading:()=>gn,showSuccess:()=>fn});var i=t(72),s=t.n(i),l=t(825),d=t.n(l),c=t(659),u=t.n(c),p=t(56),m=t.n(p),g=t(540),f=t.n(g),h=t(113),b=t.n(h),y=t(379),v={};v.styleTagTransform=b(),v.setAttributes=m(),v.insert=u().bind(null,"head"),v.domAPI=d(),v.insertStyleElement=f(),s()(y.A,v),y.A&&y.A.locals&&y.A.locals;const w=(n,e)=>e.some((e=>n instanceof e));let x,k;const S=new WeakMap,E=new WeakMap,I=new WeakMap;let M={get(n,e,t){if(n instanceof IDBTransaction){if("done"===e)return S.get(n);if("store"===e)return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return D(n[e])},set:(n,e,t)=>(n[e]=t,!0),has:(n,e)=>n instanceof IDBTransaction&&("done"===e||"store"===e)||e in n};function B(n){M=n(M)}function T(n){return"function"==typeof n?(e=n,(k||(k=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...n){return e.apply(C(this),n),D(this.request)}:function(...n){return D(e.apply(C(this),n))}):(n instanceof IDBTransaction&&function(n){if(S.has(n))return;const e=new Promise(((e,t)=>{const o=()=>{n.removeEventListener("complete",r),n.removeEventListener("error",a),n.removeEventListener("abort",a)},r=()=>{e(),o()},a=()=>{t(n.error||new DOMException("AbortError","AbortError")),o()};n.addEventListener("complete",r),n.addEventListener("error",a),n.addEventListener("abort",a)}));S.set(n,e)}(n),w(n,x||(x=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(n,M):n);var e}function D(n){if(n instanceof IDBRequest)return function(n){const e=new Promise(((e,t)=>{const o=()=>{n.removeEventListener("success",r),n.removeEventListener("error",a)},r=()=>{e(D(n.result)),o()},a=()=>{t(n.error),o()};n.addEventListener("success",r),n.addEventListener("error",a)}));return I.set(e,n),e}(n);if(E.has(n))return E.get(n);const e=T(n);return e!==n&&(E.set(n,e),I.set(e,n)),e}const C=n=>I.get(n),j=["get","getKey","getAll","getAllKeys","count"],z=["put","add","delete","clear"],A=new Map;function P(n,e){if(!(n instanceof IDBDatabase)||e in n||"string"!=typeof e)return;if(A.get(e))return A.get(e);const t=e.replace(/FromIndex$/,""),o=e!==t,r=z.includes(t);if(!(t in(o?IDBIndex:IDBObjectStore).prototype)||!r&&!j.includes(t))return;const a=async function(n,...e){const a=this.transaction(n,r?"readwrite":"readonly");let i=a.store;return o&&(i=i.index(e.shift())),(await Promise.all([i[t](...e),r&&a.done]))[0]};return A.set(e,a),a}B((n=>({...n,get:(e,t,o)=>P(e,t)||n.get(e,t,o),has:(e,t)=>!!P(e,t)||n.has(e,t)})));const q=["continue","continuePrimaryKey","advance"],O={},F=new WeakMap,$=new WeakMap,N={get(n,e){if(!q.includes(e))return n[e];let t=O[e];return t||(t=O[e]=function(...n){F.set(this,$.get(this)[e](...n))}),t}};async function*H(...n){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...n)),!e)return;const t=new Proxy(e,N);for($.set(t,e),I.set(t,C(e));e;)yield t,e=await(F.get(t)||e.continue()),F.delete(t)}function V(n,e){return e===Symbol.asyncIterator&&w(n,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===e&&w(n,[IDBIndex,IDBObjectStore])}B((n=>({...n,get:(e,t,o)=>V(e,t)?H:n.get(e,t,o),has:(e,t)=>V(e,t)||n.has(e,t)})));const W="stories",G=function(n,e,{blocked:t,upgrade:o,blocking:r,terminated:a}={}){const i=indexedDB.open(n,e),s=D(i);return o&&i.addEventListener("upgradeneeded",(n=>{o(D(i.result),n.oldVersion,n.newVersion,D(i.transaction),n)})),t&&i.addEventListener("blocked",(n=>t(n.oldVersion,n.newVersion,n))),s.then((n=>{a&&n.addEventListener("close",(()=>a())),r&&n.addEventListener("versionchange",(n=>r(n.oldVersion,n.newVersion,n)))})).catch((()=>{})),s}("story-app-db",1,{upgrade(n){n.objectStoreNames.contains(W)||n.createObjectStore(W,{keyPath:"id"})}}),R={async put(n){if(!n.id)throw new Error("Story harus memiliki properti id yang unik");return(await G).put(W,n)},getAll:async()=>(await G).getAll(W),delete:async n=>(await G).delete(W,n)},U="https://story-api.dicoding.dev/v1";function K(){return localStorage.getItem("token")}async function Y(){const n=K();if(!n)throw new Error("Token tidak ditemukan. Silakan login.");const e=await fetch(`${U}/stories`,{headers:{Authorization:`Bearer ${n}`}});if(!e.ok)throw new Error("Gagal memuat cerita");return(await e.json()).listStory}let _,J;const X=function(n){let{modelModule:e,viewModule:t}=n;_=e,J=t},Z=async function(){try{const n=await Y();for(const e of n)await R.put(e);J.renderHome(n)}catch(n){const e=await R.getAll();e.length>0?J.renderHome(e):J.renderError("Tidak ada data yang tersedia.")}};let Q,nn;async function en(n){let{description:e,photo:t,lat:o,lon:r}=n;if(e&&t&&o&&r)try{nn.showLoading(!0);const n=await Q.postStory({description:e,photo:t,lat:o,lon:r});nn.showSuccess(n.message),location.hash="#/home"}catch(n){nn.showError(n.message||"Terjadi kesalahan saat mengirim data")}finally{nn.showLoading(!1)}else nn.showError("Pastikan semua data lengkap!")}const tn=function(n){let{modelModule:e,viewModule:t}=n;Q=e,nn=t},on=function(){nn.renderAddForm({onSubmit:en})};async function rn(){return await Y()}async function an(n){return await async function(n){let{description:e,photo:t,lat:o,lon:r}=n;const a=K();if(!a)throw new Error("Token tidak ditemukan. Silakan login.");const i=new FormData;i.append("description",e),i.append("photo",t),o&&r&&(i.append("lat",o),i.append("lon",r));const s=await fetch(`${U}/stories`,{method:"POST",headers:{Authorization:`Bearer ${a}`},body:i});if(!s.ok){const n=await s.json();throw new Error(n.message||"Gagal mengirim cerita")}return s.json()}(n)}let sn;const ln=function(n){let{viewModule:e}=n;sn=e},dn=async function(){try{await rn()}catch(n){console.error("Gagal menampilkan cerita:",n.message)}};function cn(){const n=document.querySelector("nav"),e=localStorage.getItem("token");if(n.innerHTML=`\n    <div class="nav-container">\n      <div class="brand" tabindex="0" aria-label="My Story Homepage">My Story</div>\n      ${e?'\n            <button class="hamburger" id="hamburgerBtn" aria-label="Toggle navigation menu" aria-expanded="false" aria-controls="navList">\n              <span class="bar"></span>\n              <span class="bar"></span>\n              <span class="bar"></span>\n            </button>\n            <ul id="navList" class="nav-list" role="menubar" aria-label="Primary navigation">\n              <li role="none"><a role="menuitem" href="#/">Home</a></li>\n              <li role="none"><a role="menuitem" href="#/add">Tambah Cerita</a></li>\n              <li role="none"><a role="menuitem" href="#" id="logoutLink">Logout</a></li>\n            </ul>\n          ':""}\n    </div>\n  `,!e)return;const t=document.getElementById("logoutLink");t&&t.addEventListener("click",(n=>{n.preventDefault(),localStorage.removeItem("token"),window.location.hash="#/login",cn(),document.body.classList.remove("nav-open")}));const o=document.getElementById("hamburgerBtn"),r=document.getElementById("navList");if(!o||!r)return;const a=()=>{const n=r.classList.toggle("show");o.setAttribute("aria-expanded",n),o.classList.toggle("active",n),document.body.classList.toggle("nav-open",n)};o.addEventListener("click",a),o.addEventListener("keydown",(n=>{"Enter"!==n.key&&" "!==n.key||(n.preventDefault(),a())})),r.querySelectorAll("a").forEach((n=>{n.addEventListener("click",(()=>{r.classList.remove("show"),o.classList.remove("active"),o.setAttribute("aria-expanded","false"),document.body.classList.remove("nav-open")}))}))}function un(n){document.startViewTransition?document.startViewTransition((()=>(n(),Promise.resolve()))):n()}function pn(n){const e=document.getElementById("main-content"),t=document.querySelector("nav"),o=document.querySelector("footer");if(t&&(t.style.display="flex"),o&&(o.style.display="block"),!n.length)return void(e.innerHTML="<h2>Daftar Cerita</h2><p>Tidak ada cerita.</p>");const r=n.map((n=>`\n    <div class="story-card">\n      <img src="${n.photoUrl}" alt="Foto oleh ${n.name}" loading="lazy" />\n      <div class="story-info">\n        <h3>${n.name}</h3>\n        <p>${n.description}</p>\n        <small>${new Date(n.createdAt).toLocaleString()}</small>\n      </div>\n    </div>\n  `)).join("");e.innerHTML=`\n    <h2>Daftar Cerita</h2>\n    <div class="story-grid">${r}</div>\n    <div id="homeMap" style="height: 400px; margin-top: 2rem;"></div>\n  `,function(n){const e="homeMap";if(!document.getElementById(e))return;const t=L.map(e).setView([-2.5,118],5);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(t),n.forEach((n=>{n.lat&&n.lon&&L.marker([n.lat,n.lon]).addTo(t).bindPopup(`\n        <b>${n.name||"Pengguna"}</b><br />\n        ${n.description}<br />\n        ${new Date(n.createdAt).toLocaleDateString()}\n      `)}))}(n)}function mn(n){let{onSubmit:e}=n;document.getElementById("main-content").innerHTML='\n    <section class="add-story-container">\n      <h2>Tambah Cerita</h2>\n      <form id="storyForm" class="styled-form">\n        <label for="description">Deskripsi:</label>\n        <input type="text" id="description" name="description" placeholder="Tulis deskripsi singkat..." required />\n\n        <label>Ambil Foto:</label>\n        <div class="camera-container">\n          <video id="camera" autoplay playsinline></video>\n          <button type="button" id="takePhoto" class="btn-primary">Ambil Foto</button>\n        </div>\n        <canvas id="canvas" style="display:none;"></canvas>\n\n        <label for="lat">Latitude:</label>\n        <input type="number" id="lat" name="lat" required step="any" placeholder="Contoh: -6.200000" />\n\n        <label for="lon">Longitude:</label>\n        <input type="number" id="lon" name="lon" required step="any" placeholder="Contoh: 106.816666" />\n\n        <button type="submit" class="btn-submit">Kirim Cerita</button>\n      </form>\n\n      <div id="addMap" class="map-container"></div>\n      <div id="loading" class="loading-indicator" style="display:none;">Mengirim...</div>\n    </section>\n  ';const t=document.getElementById("storyForm"),o=document.getElementById("camera"),r=document.getElementById("canvas"),a=document.getElementById("takePhoto");let i=null;navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then((n=>{o.srcObject=n})).catch((n=>{console.error("Gagal membuka kamera:",n),alert("Kamera tidak tersedia atau izin ditolak.")})),a.addEventListener("click",(()=>{const n=r.getContext("2d");r.width=o.videoWidth,r.height=o.videoHeight,n.drawImage(o,0,0,r.width,r.height),r.toBlob((n=>{i=new File([n],"photo.jpg",{type:"image/jpeg"}),alert("Foto berhasil diambil!")}),"image/jpeg")})),t.addEventListener("submit",(n=>{n.preventDefault();const o=t.description.value.trim(),r=t.lat.value.trim(),a=t.lon.value.trim();i?e({description:o,photo:i,lat:r,lon:a}):alert("Silakan ambil foto terlebih dahulu!")})),function(n){let{onLocationSelect:e}=n;const t="addMap";if(!document.getElementById(t))return;const o=L.map(t).setView([-2.5,118],5);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(o);let r=null;o.on("click",(function(n){const t=n.latlng.lat.toFixed(6),a=n.latlng.lng.toFixed(6);r&&o.removeLayer(r),r=L.marker([t,a]).addTo(o).bindPopup(`Lokasi dipilih:<br>Lat: ${t}<br>Lon: ${a}`).openPopup(),e({lat:t,lon:a})}))}({onLocationSelect:n=>{let{lat:e,lon:o}=n;t.lat.value=e,t.lon.value=o}})}function gn(n){const e=document.querySelector(".loading-indicator");e&&(e.style.display=n?"block":"none")}function fn(n){alert(`Sukses: ${n}`)}function hn(n){alert(`Gagal: ${n}`)}let bn=!1;function yn(){const n=localStorage.getItem("token"),e=window.location.hash||"#/home";if(document.querySelector("main"))if(n||"#/login"===e||"#/register"===e)switch(bn||(X({modelModule:o,viewModule:r}),tn({modelModule:o,viewModule:a}),ln({modelModule:o,viewModule:null}),bn=!0),e){case"#/home":case"#/":default:un((()=>{Z(),dn()}));break;case"#/add":un((()=>on()));break;case"#/login":un((()=>function(n){let{onSubmit:e}=n;const t=document.querySelector("main"),o=document.querySelector("nav"),r=document.querySelector("footer");o&&(o.style.display="block"),r&&(r.style.display="block"),t.innerHTML='\n    <section class="login-container">\n      <h2>Masuk</h2>\n      <form id="login-form" class="styled-form">\n        <input type="email" id="email" placeholder="Email" required />\n        <input type="password" id="password" placeholder="Password" required />\n        <button type="submit">Login</button>\n      </form>\n      <p class="login-link">Belum punya akun? <a href="#/register">Daftar</a></p>\n    </section>\n  ',cn(),document.getElementById("login-form").addEventListener("submit",(async n=>{n.preventDefault();const t=document.getElementById("email").value,o=document.getElementById("password").value;await e({email:t,password:o})}))}({onSubmit:async n=>{let{email:e,password:t}=n;const o=await async function(n){let{email:e,password:t}=n;try{const n=await fetch("https://story-api.dicoding.dev/v1/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),o=await n.json();if(!n.ok)throw new Error(o.message||"Login gagal");return localStorage.setItem("token",o.loginResult.token),!0}catch(n){return alert("Gagal login. Cek email dan password.\n"+n.message),!1}}({email:e,password:t});o&&(window.location.hash="#/home")}})));break;case"#/register":un((()=>function(){document.getElementById("main-content").innerHTML='\n    <section class="login-container">\n      <h2>Daftar Akun</h2>\n      <form id="registerForm" class="styled-form" novalidate>\n        <input type="text" id="name" name="name" placeholder="Nama Lengkap" required minlength="3" />\n        <input type="email" id="email" name="email" placeholder="Email" required />\n        <input type="password" id="password" name="password" placeholder="Password" required minlength="6" />\n        \n        <button type="submit" id="submitBtn">Daftar</button>\n        <p id="errorMsg" style="color: red; margin-top: 10px; display: none;"></p>\n      </form>\n      <p class="login-link">Sudah punya akun? <a href="#/login">Masuk</a></p>\n    </section>\n  ';const n=document.getElementById("registerForm"),e=document.getElementById("submitBtn"),t=document.getElementById("errorMsg");n.addEventListener("submit",(async o=>{o.preventDefault(),t.style.display="none",t.textContent="";const r=n.name.value.trim(),a=n.email.value.trim(),i=n.password.value;if(r.length<3)return t.textContent="Nama lengkap minimal 3 karakter.",void(t.style.display="block");if(i.length<6)return t.textContent="Password minimal 6 karakter.",void(t.style.display="block");e.disabled=!0,e.textContent="Mendaftar...";try{const e=await async function(n){let{name:e,email:t,password:o}=n;try{const n=await fetch("https://story-api.dicoding.dev/v1/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:t,password:o})}),r=await n.json();if(!n.ok)throw new Error(r.message||"Terjadi kesalahan saat registrasi");return!0}catch(n){return alert("Terjadi kesalahan saat registrasi. Coba lagi.\n"+n.message),!1}}({name:r,email:a,password:i});e?(n.reset(),window.location.hash="#/login"):(t.textContent="Registrasi gagal, silakan coba lagi.",t.style.display="block")}catch(n){t.textContent=`Error: ${n.message||"Terjadi kesalahan."}`,t.style.display="block"}finally{e.disabled=!1,e.textContent="Daftar"}}))}()))}else window.location.hash="#/login"}function vn(n){const e=(n+"=".repeat((4-n.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),t=atob(e);return Uint8Array.from([...t].map((n=>n.charCodeAt(0))))}const wn={renderStories:function n(e){const t=document.getElementById("stories-container");t&&(t.innerHTML="",e.forEach((n=>{if(!n.id)return void console.warn("Story tanpa id ditemukan, abaikan:",n);const e=document.createElement("div");e.classList.add("story-item"),e.innerHTML=`\n      <p>${n.description||"No description"}</p>\n      <small>${new Date(n.createdAt||Date.now()).toLocaleString()}</small>\n      <button class="delete-btn" data-id="${n.id}" aria-label="Hapus cerita ini">Hapus</button>\n    `,t.appendChild(e)})),t.querySelectorAll(".delete-btn").forEach((e=>{e.addEventListener("click",(async e=>{const t=e.target.dataset.id;if(t)try{await R.delete(t),n(await R.getAll())}catch(n){console.error("Gagal menghapus story dari IndexedDB:",n)}}))})))}},{renderStories:xn}=wn;function kn(){yn(),cn();const n=localStorage.getItem("token"),e=window.location.hash;n&&"#/login"!==e&&"#/register"!==e&&async function(){try{const n=await Y();await Promise.all(n.map((n=>R.put(n)))),xn(n)}catch(n){console.warn("⚠️ Fetch failed. Loading from cache...",n);const e=await R.getAll();e.length>0?xn(e):console.error("❌ No cached stories found.")}}()}window.addEventListener("load",(()=>{"serviceWorker"in navigator?navigator.serviceWorker.register("/service-worker.js").then((n=>{console.log("✅ Service Worker Registered with scope:",n.scope)})).catch((n=>{console.error("❌ Service Worker Registration Failed:",n)})):console.warn("⚠️ Service Worker is not supported in this browser."),async function(){if(!("Notification"in window))return void console.warn("Push Notification tidak didukung browser ini.");if("granted"!==await Notification.requestPermission())return void console.warn("Push permission ditolak.");const n=await navigator.serviceWorker.ready;try{const e=await n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:vn("BM8s1W9x9Yl5kZ3Io3QpLqz3kEfh0Ua4bvFlZzQOyEmnLV0kJYXp_6d5FX7Y9-k0zIYV8r7M8XPrxS7Zg9qBvRE")});await fetch("https://story-api.dicoding.dev/v1/subscribe",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}),console.log("✅ Push Notification berhasil disubscribe dan dikirim ke backend!")}catch(n){console.error("❌ Gagal Subscribe Push:",n)}}()})),window.addEventListener("hashchange",kn),window.addEventListener("DOMContentLoaded",(function(){const n=localStorage.getItem("token"),e=window.location.hash;n||"#/login"===e||"#/register"===e?kn():window.location.hash="#/login"}))})();